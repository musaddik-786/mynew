from langgraph.graph import StateGraph, START, END

from typing_extensions import Annotated

from langgraph.graph.message import add_messages

# -------------------

# State

# -------------------

class State(dict):

    messages: Annotated[list, add_messages]

# -------------------

# Agent node

# -------------------

def agent(state):

    if len(state["messages"]) == 0:

        return {"messages": ["Agent: I need a tool"]}

    else:

        return {"messages": ["Agent: I got tool result, End"]}

# -------------------

# Tool node (FAKE tool)

# -------------------

def tools(state):

    return {"messages": ["Tool: Here is the data"]}

# -------------------

# Router (decision maker)

# -------------------

def router(state):

    last_message = state["messages"][-1]

    if "need a tool" in last_message:

        return "tools"

    if "End" in last_message:

        return "end"

    return "end"

# -------------------

# Build graph

# -------------------

graph = StateGraph(State)

graph.add_node("agent", agent)

graph.add_node("tools", tools)

graph.add_edge(START, "agent")

graph.add_conditional_edges(

    "agent",

    router,

    {

        "tools": "tools",

        "end": END

    }

)

graph.add_edge("tools", "agent")

graph = graph.compile()

# -------------------

# Run

# -------------------

result = graph.invoke({"messages": []})

print(result)
